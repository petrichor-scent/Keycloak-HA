version: '3'

services:
  keycloak-2:
    image: quay.io/keycloak/keycloak:${KC_VERSION}
    environment:
      # db config
      KC_DB: postgres
      KC_DB_URL: jdbc:postgresql://${KC_DB_HOST}:${KC_DB_PORT}/${KC_DB_DATABASE}
      KC_DB_HOST: ${KC_DB_HOST}
      KC_DB_DATABASE: ${KC_DB_DATABASE}
      KC_DB_USERNAME: ${KC_DB_USERNAME}
      KC_DB_PASSWORD: ${KC_DB_PASSWORD}

      # admin credentials
      KEYCLOAK_ADMIN: ${KEYCLOAK_ADMIN}
      KEYCLOAK_ADMIN_PASSWORD: ${KEYCLOAK_ADMIN_PASSWORD}
      
      # log config
      KC_LOG_LEVEL: INFO,org.infinispan:DEBUG,org.jgroups:DEBUG
    command:
      - start-dev
      - --cache=ispn
      - --cache-stack=tcp
      - --http-port=8080
      - --proxy=edge
    network_mode: 'host'
